<% provide(:title, "現場溶剤情報登録") %>
<% provide(:btn_text, "登録") %>

<div class="card">
  <div class="card-body">
    <%= form_with model: @field_solvent, url: users_order_field_solvents_path, method: :post, local: true, class: "field_solvent-form-validation" do |f| %>

      <%= render 'shared/error_massages', object: f.object %>

      <div class="row">
        <div class="col-md-3">
          <%= f.label :date_submitted %>
          <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
          <%= f.date_field :date_submitted, class: "form-control" %>
        </div>
      </div><br>
      <div class="row">
        <div class="col-md-3">
          <%= f.label :solvent_name_one %>
          <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
          <%= f.collection_select :solvent_name_one, Solvent.where(business_id: @order.business_id), :name, :name, { include_blank: '商品名1を選択してください' }, { class: 'form-control', :onchange => "getSolventName1($(this).val())" } %>
        </div>
        <div class="col-md-3">
          <%= f.label :carried_quantity_one %>
          <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
          <%= f.text_field :carried_quantity_one, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:carried_quantity_one) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_classification_one %>
          <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
          <%= f.text_field :solvent_classification_one, id: :solvent_classification_one, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_classification_one) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_ingredients_one %>
          <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
          <%= f.text_field :solvent_ingredients_one, id: :solvent_ingredients_one, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_ingredients_one) %>
        </div>
      </div><br>
      <div class="row">
        <div class="col-md-3">
          <%= f.label :solvent_name_two %>
          <%= f.collection_select :solvent_name_two, Solvent.where(business_id: @order.business_id), :name, :name, { include_blank: '商品名2を選択してください' }, { class: 'form-control', :onchange => "getSolventName2($(this).val())" } %>
        </div>
        <div class="col-md-3">
          <%= f.label :carried_quantity_two %>
          <%= f.text_field :carried_quantity_two, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:carried_quantity_two) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_classification_two %>
          <%= f.text_field :solvent_classification_two, id: :solvent_classification_two, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_classification_two) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_ingredients_two %>
          <%= f.text_field :solvent_ingredients_two, id: :solvent_ingredients_two, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_ingredients_two) %>
        </div>
      </div><br>
      <div class="row">
        <div class="col-md-3">
          <%= f.label :solvent_name_three %>
          <%= f.collection_select :solvent_name_three, Solvent.where(business_id: @order.business_id), :name, :name, { include_blank: '商品名3を選択してください' }, { class: 'form-control', :onchange => "getSolventName3($(this).val())" } %>
        </div>
        <div class="col-md-3">
          <%= f.label :carried_quantity_three %>
          <%= f.text_field :carried_quantity_three, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:carried_quantity_three) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_classification_three %>
          <%= f.text_field :solvent_classification_three, id: :solvent_classification_three, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_classification_three) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_ingredients_three %>
          <%= f.text_field :solvent_ingredients_three, id: :solvent_ingredients_three, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_ingredients_three) %>
        </div>
      </div><br>
      <div class="row">
        <div class="col-md-3">
          <%= f.label :solvent_name_four %>
          <%= f.collection_select :solvent_name_four, Solvent.where(business_id: @order.business_id), :name, :name, { include_blank: '商品名4を選択してください' }, { class: 'form-control', :onchange => "getSolventName4($(this).val())" } %>
        </div>
        <div class="col-md-3">
          <%= f.label :carried_quantity_four %>
          <%= f.text_field :carried_quantity_four, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:carried_quantity_four) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_classification_four %>
          <%= f.text_field :solvent_classification_four, id: :solvent_classification_four, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_classification_four) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_ingredients_four %>
          <%= f.text_field :solvent_ingredients_four, id: :solvent_ingredients_four, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_ingredients_four) %>
        </div>
      </div><br>
      <div class="row">
        <div class="col-md-3">
          <%= f.label :solvent_name_five %>
          <%= f.collection_select :solvent_name_five, Solvent.where(business_id: @order.business_id), :name, :name, { include_blank: '商品名5を選択してください' }, { class: 'form-control', :onchange => "getSolventName5($(this).val())" } %>
        </div>
        <div class="col-md-3">
          <%= f.label :carried_quantity_five %>
          <%= f.text_field :carried_quantity_five, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:carried_quantity_five) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_classification_five %>
          <%= f.text_field :solvent_classification_five, id: :solvent_classification_five, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_classification_five) %>
        </div><br>
        <div class="col-md-3">
          <%= f.label :solvent_ingredients_five %>
          <%= f.text_field :solvent_ingredients_five, id: :solvent_ingredients_five, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:solvent_ingredients_five) %>
        </div>
      </div><br>
      <br>
      <%= f.label :using_location %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.text_field :using_location, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:using_location), maxlength: 100 %>
      <br>
      <%= f.label :storing_place %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.text_field :storing_place, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:storing_place), maxlength: 100 %>
      <br>
      <%= f.label :using_tool %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.text_field :using_tool, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:using_tool), maxlength: 40 %>
      <br>
      <%= f.label :usage_period_start %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <br>
      <%= f.date_field :usage_period_start, class: "form-control", style: "width: auto; display: inline-block;" %>
      <br><br>
      <%= f.label :usage_period_end %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <br>
      <%= f.date_field :usage_period_end, class: "form-control", style: "width: auto; display: inline-block;" %>
      <br><br>
      <%= f.label :working_process %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.select :working_process, FieldSolvent.working_processes_i18n.invert,{include_blank: true}, {class: "form-control"} %>
      <br>
      <%= f.label :sds %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.select :sds, FieldSolvent.sds_i18n.invert,{include_blank: true}, {class: "form-control"} %>
      <br>
      <%= f.label :ventilation_control %>
      <span class="p-1 mb-2 rounded bg-danger text-white">必須</span>
      <%= f.text_field :ventilation_control, class: "form-control", placeholder: FieldSolvent.human_attribute_name(:ventilation_control) %>
      <br>

      <script>
        $(function(){
          $.each(function(key){
            $.validator.addMethod(key, this);
          });
          $(".field_solvent-form-validation").validate({
            rules:{
              "field_solvent[date_submitted]": {
                required: true
              },
              "field_solvent[solvent_name_one]": {
                required: true
              },
              "field_solvent[carried_quantity_one]": {
                required: true
              },
              "field_solvent[solvent_classification_one]": {
                required: true
              },
              "field_solvent[solvent_ingredients_one]": {
                required: true
              },
              "field_solvent[using_location]": {
                required: true
              },
              "field_solvent[storing_place]": {
                required: true
              },
              "field_solvent[using_tool]": {
                required: true
              },
              "field_solvent[usage_period_start]": {
                required: true
              },
              "field_solvent[usage_period_end]": {
                required: true
              },
              "field_solvent[working_process]": {
                required: true
              },
              "field_solvent[sds]": {
                required: true
              },
              "field_solvent[ventilation_control]": {
                required: true
              },
            },
            messages:{
              "field_solvent[date_submitted]": {
                required: "提出日を入力してください。"
              },
              "field_solvent[solvent_name_one]": {
                required: "商品名1を入力してください。"
              },
              "field_solvent[carried_quantity_one]": {
                required: "搬入量1を入力してください。"
              },
              "field_solvent[solvent_classification_one]": {
                required: "種別1を入力してください。"
              },
              "field_solvent[solvent_ingredients_one]": {
                required: "含有成分1を入力してください。"
              },
              "field_solvent[using_location]": {
                required: "使用場所を入力してください。"
              },
              "field_solvent[storing_place]": {
                required: "保管場所を入力してください。"
              },
              "field_solvent[using_tool]": {
                required: "使用機械又は工具を入力してください。"
              },
              "field_solvent[usage_period_start]": {
                required: "使用期間(始期)を入力してください。"
              },
              "field_solvent[usage_period_end]": {
                required: "使用期間(終期)を入力してください。"
              },
              "field_solvent[working_process]": {
                required: "作業手順書の添付の有無を入力してください。"
              },
              "field_solvent[sds]": {
                required: "SDS(安全データシート)の添付の有無を入力してください。"
              },
              "field_solvent[ventilation_control]": {
                required: "換気等対策を入力してください。"
              },
            },
            errorClass: "input_form_error"
          });
          // 入力欄を変更したときにバリデーションを実行
          $(".field_solvent-form-validation").change(function () {
            $(this).valid();
          });
        });
      </script>

      <script>
        function getSolventName1(val){
          var solvent_name_one = val;

          $.ajax({
            url: 'set_solvent_name_one',
            type: "GET",
            data: {
              solvent_name_one: solvent_name_one
            }
          })
        }

        function getSolventName2(val){
          var solvent_name_two = val;

          $.ajax({
            url: 'set_solvent_name_two',
            type: "GET",
            data: {
              solvent_name_two: solvent_name_two
            }
          })
        }

        function getSolventName3(val){
          var solvent_name_three = val;

          $.ajax({
            url: 'set_solvent_name_three',
            type: "GET",
            data: {
              solvent_name_three: solvent_name_three
            }
          })
        }

        function getSolventName4(val){
          var solvent_name_four = val;

          $.ajax({
            url: 'set_solvent_name_four',
            type: "GET",
            data: {
              solvent_name_four: solvent_name_four
            }
          })
        }

        function getSolventName5(val){
          var solvent_name_five = val;

          $.ajax({
            url: 'set_solvent_name_five',
            type: "GET",
            data: {
              solvent_name_five: solvent_name_five
            }
          })
        }
      </script>

      <%= f.submit yield(:btn_text), class: "btn btn-md btn-block btn-primary" %>
      <%= link_to "現場詳細画面へ", users_order_url(@order), class: "btn btn-md btn-block btn-default" %>
    <% end %>
  </div>
</div>
