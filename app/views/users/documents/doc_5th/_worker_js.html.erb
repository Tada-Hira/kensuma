<script>
let select = document.querySelector('[id="worker_select_<%= index %>"]');

select.onchange = async event => {
  worker = await fetch_worker(select.value);
  console.log(worker);
  apply_form(worker);
}

// =============以下関数定義=========

async function fetch_worker(worker_id) {

  const WORKER_API_URL = '/api/users/workers/'
  console.log("start fetch_worker!")

  const result = await fetch( WORKER_API_URL + worker_id, { method: 'GET' })
    .then( response => {
        return response.json()
      }
    )

  console.log("end fetch_worker!")
  return result['worker']
}

function apply_form(worker) {
  console.log("start apply_form!")

  document.getElementsByName("document[content][worker][doc5_8_012_furigana][]")[<%= index %>].value = worker['name_kana']
  console.log("end apply_form!")
}

</script>
